<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Details - Admin Dashboard</title>
    <link th:href="@{/webjars/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
</head>
<body class="bg-light">
<!-- Navigation Bar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a class="navbar-brand" href="/admin">
            <i class="fas fa-shield-alt me-2"></i>Admin Dashboard
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/admin"><i class="fas fa-home me-1"></i>Dashboard</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/users"><i class="fas fa-users me-1"></i>Users</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/admin/sessions"><i class="fas fa-clock me-1"></i>Sessions</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="/admin/clients"><i class="fas fa-desktop me-1"></i>Clients</a>
                </li>
            </ul>
            <div class="navbar-nav">
                <a class="nav-link" href="/logout">
                    <i class="fas fa-sign-out-alt me-1"></i>Logout
                </a>
            </div>
        </div>
    </div>
</nav>

<!-- Main Content -->
<div class="container mt-4">
    <!-- Page Header -->
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1 class="h2">
                    <i class="fas fa-desktop me-2"></i><span th:text="${client.displayName}">Client Name</span>
                </h1>
                <a href="/admin/clients" class="btn btn-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Clients
                </a>
            </div>
        </div>
    </div>

    <!-- Client Overview -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>Client Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td class="fw-bold">Client ID:</td>
                                    <td><code th:text="${client.clientId}">client-id</code></td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Display Name:</td>
                                    <td th:text="${client.displayName}">Display Name</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Registered:</td>
                                    <td th:text="${#temporals.format(client.registeredTime, 'yyyy-MM-dd HH:mm')}">
                                        2024-01-01 12:00
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless">
                                <tr>
                                    <td class="fw-bold">Consent Required:</td>
                                    <td>
                                            <span th:if="${client.requireConsent}" class="badge bg-warning">
                                                <i class="fas fa-check me-1"></i>Yes
                                            </span>
                                        <span th:unless="${client.requireConsent}" class="badge bg-secondary">
                                                <i class="fas fa-times me-1"></i>No
                                            </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Reuse Refresh Tokens:</td>
                                    <td>
                                            <span th:if="${client.reuseRefreshTokens}" class="badge bg-info">
                                                <i class="fas fa-check me-1"></i>Yes
                                            </span>
                                        <span th:unless="${client.reuseRefreshTokens}" class="badge bg-secondary">
                                                <i class="fas fa-times me-1"></i>No
                                            </span>
                                    </td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-chart-pie me-2"></i>Quick Stats
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-6">
                            <div class="border-end">
                                <h4 class="text-primary" th:text="${#lists.size(authorizations)}">0</h4>
                                <p class="mb-0 small text-muted">Authorizations</p>
                            </div>
                        </div>
                        <div class="col-6">
                            <h4 class="text-success"
                                th:text="${authorizations != null ? authorizations.?[active].size() : 0}">
                                0
                            </h4>
                            <p class="mb-0 small text-muted">Active</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Authentication & Grant Types -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-key me-2"></i>Authentication Methods
                    </h5>
                </div>
                <div class="card-body">
                    <div th:each="method : ${client.authenticationMethods}" class="mb-2">
                            <span class="badge bg-primary me-2"
                                  th:text="${method == 'client_secret_basic' ?
                                              'Client Secret Basic' :
                                              (method == 'client_secret_post' ?
                                                'Client Secret Post' :
                                                method)}">
                                method
                            </span>

                        <span class="text-muted small"
                              th:text="${method == 'client_secret_basic' ?
                                              'HTTP Basic Authentication with client credentials' :
                                              (method == 'client_secret_post' ?
                                                'Client credentials sent in request body' :
                                                'Custom authentication method')}">
                                Description
                            </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-exchange-alt me-2"></i>Grant Types
                    </h5>
                </div>
                <div class="card-body">
                    <div th:each="grantType : ${client.grantTypes}" class="mb-2">
                        <span th:class="${grantType == 'authorization_code' ?
                                          'badge bg-primary me-2' :
                                          (grantType == 'client_credentials' ?
                                            'badge bg-success me-2' :
                                            (grantType == 'refresh_token' ?
                                              'badge bg-info me-2' :
                                              'badge bg-secondary me-2'))}"
                              th:text="${grantType == 'authorization_code' ?
                                          'Authorization Code' :
                                          (grantType == 'client_credentials' ?
                                            'Client Credentials' :
                                            (grantType == 'refresh_token' ?
                                              'Refresh Token' :
                                              grantType))}">
                            grant
                        </span>
                        <span class="text-muted small"
                              th:text="${grantType == 'authorization_code' ?
                                          'For web applications with user interaction' :
                                          (grantType == 'client_credentials' ?
                                            'For server-to-server communication' :
                                            (grantType == 'refresh_token' ?
                                              'For token renewal' :
                                              'Custom grant type'))}">
                            Description
                        </span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scopes & URLs -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-shield-alt me-2"></i>Authorized Scopes
                    </h5>
                </div>
                <div class="card-body">
                    <div th:each="scope : ${client.scopes}" class="mb-2">
                        <span class="badge bg-light text-dark border me-2" th:text="${scope}">scope</span>
                        <span class="text-muted small" th:switch="${scope}">
                                <span th:case="'openid'">OpenID Connect identity verification</span>
                                <span th:case="'profile'">Basic profile information</span>
                                <span th:case="'email'">Email address access</span>
                                <span th:case="'meeting.read'">Read meeting information</span>
                                <span th:case="'meeting.write'">Create and modify meetings</span>
                                <span th:case="'mcp.invoke'">MCP service access</span>
                                <span th:case="*">Custom scope permission</span>
                            </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-link me-2"></i>Redirect URIs
                    </h5>
                </div>
                <div class="card-body">
                    <div th:if="${#sets.isEmpty(client.redirectUris)}" class="text-muted">
                        No redirect URIs configured.
                    </div>
                    <div th:unless="${#sets.isEmpty(client.redirectUris)}">
                        <div th:each="uri : ${client.redirectUris}" class="mb-2">
                            <code class="text-primary" th:text="${uri}">http://localhost:8080/callback</code>
                        </div>
                    </div>

                    <div th:unless="${#sets.isEmpty(client.postLogoutRedirectUris)}" class="mt-3">
                        <h6 class="text-muted">Post Logout URIs:</h6>
                        <div th:each="uri : ${client.postLogoutRedirectUris}" class="mb-2">
                            <code class="text-secondary" th:text="${uri}">http://localhost:8080/</code>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Token Settings -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-clock me-2"></i>Token Settings
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-key fa-2x text-primary mb-2"></i>
                                <h5>Access Token TTL</h5>
                                <p class="mb-0" th:text="${client.accessTokenTtl}">1 hour</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-redo fa-2x text-info mb-2"></i>
                                <h5>Refresh Token TTL</h5>
                                <p class="mb-0" th:text="${client.refreshTokenTtl}">7 days</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 border rounded">
                                <i class="fas fa-recycle fa-2x text-success mb-2"></i>
                                <h5>Refresh Token Reuse</h5>
                                <p class="mb-0" th:if="${client.reuseRefreshTokens}">
                                    <span class="badge bg-success">Enabled</span>
                                </p>
                                <p class="mb-0" th:unless="${client.reuseRefreshTokens}">
                                    <span class="badge bg-secondary">Disabled</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Authorizations -->
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-users me-2"></i>Recent Authorizations
                    </h5>
                </div>
                <div class="card-body">
                    <div th:if="${#lists.isEmpty(authorizations)}" class="text-center py-4">
                        <i class="fas fa-key fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No authorizations found for this client.</p>
                        <p class="text-muted small">Authorizations will appear here when users authenticate with this
                            client.</p>
                    </div>

                    <div th:unless="${#lists.isEmpty(authorizations)}" class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                            <tr>
                                <th><i class="fas fa-user me-1"></i>User</th>
                                <th><i class="fas fa-shield-alt me-1"></i>Scopes</th>
                                <th><i class="fas fa-clock me-1"></i>Authorized</th>
                                <th><i class="fas fa-hourglass-end me-1"></i>Expires</th>
                                <th><i class="fas fa-check-circle me-1"></i>Status</th>
                                <th><i class="fas fa-cogs me-1"></i>Actions</th>
                            </tr>
                            </thead>
                            <tbody>
                            <tr th:each="auth : ${authorizations}">
                                <td>
                                    <strong th:text="${auth.principalName}">username</strong>
                                </td>
                                <td>
                                    <div th:each="scope : ${#strings.listSplit(auth.scopes, ', ')}"
                                         class="d-inline-block">
                                        <span class="badge bg-secondary me-1 mb-1" th:text="${scope}">scope</span>
                                    </div>
                                </td>
                                <td>
                                    <span th:text="${#temporals.format(auth.authorizationTime, 'yyyy-MM-dd HH:mm')}">2024-01-01 12:00</span>
                                </td>
                                <td>
                                            <span th:if="${auth.accessTokenExpiresAt != null}"
                                                  th:text="${#temporals.format(auth.accessTokenExpiresAt, 'yyyy-MM-dd HH:mm')}">2024-01-01 13:00</span>
                                    <span th:unless="${auth.accessTokenExpiresAt != null}" class="text-muted">N/A</span>
                                </td>
                                <td>
                                            <span th:if="${auth.active}" class="badge bg-success">
                                                <i class="fas fa-check me-1"></i>Active
                                            </span>
                                    <span th:unless="${auth.active}" class="badge bg-danger">
                                                <i class="fas fa-times me-1"></i>Expired
                                            </span>
                                </td>
                                <td>
                                    <a th:href="@{/admin/sessions/user/{username}(username=${auth.principalName})}"
                                       class="btn btn-outline-info btn-sm me-1" title="View User Sessions">
                                        <i class="fas fa-user"></i>
                                    </a>
                                    <button type="button" class="btn btn-outline-danger btn-sm"
                                            title="Revoke Authorization" data-bs-toggle="modal"
                                            th:data-bs-target="'#revokeModal-' + ${auth.id}">
                                        <i class="fas fa-ban"></i>
                                    </button>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Revoke Confirmation Modals -->
<div th:each="auth : ${authorizations}" th:id="'revokeModal-' + ${auth.id}"
     class="modal fade" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-warning me-2"></i>Confirm Revoke
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to revoke this authorization?</p>
                <div class="border rounded p-3 bg-light">
                    <div><strong>User:</strong> <span th:text="${auth.principalName}">username</span></div>
                    <div><strong>Client:</strong> <span th:text="${client.displayName}">Client Name</span></div>
                    <div><strong>Scopes:</strong> <span th:text="${auth.scopes}">scopes</span></div>
                </div>
                <p class="text-muted small mt-2">This action cannot be undone. The user will need to re-authorize the
                    client.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <form th:action="@{/admin/sessions/revoke/{authId}(authId=${auth.id})}"
                      method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-ban me-1"></i>Revoke Authorization
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/webjars/bootstrap/js/bootstrap.bundle.min.js}"></script>
</body>
</html>